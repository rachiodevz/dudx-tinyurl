<!doctype html>
<html lang="th">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì - DUDX URL Shortener</title>
        <link rel="stylesheet" href="/css/navbar.css" />
        <link rel="stylesheet" href="/css/showlink.css" />
    </head>
    <body>
        <!-- Guest Benefits Banner -->
        <div class="benefits-banner hidden" id="benefitsBanner">
            <div class="benefits-content">
                <h3 data-i18n="guest.benefitsTitle">
                    üéÅ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©!
                </h3>
                <ul class="benefits-list">
                    <li data-i18n="guest.benefit1">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</li>
                    <li data-i18n="guest.benefit2">‚ú® ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ</li>
                    <li data-i18n="guest.benefit3">
                        üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏•‡∏ö ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° memo ‡πÑ‡∏î‡πâ
                    </li>
                    <li data-i18n="guest.benefit4">‚è∞ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ</li>
                    <li data-i18n="guest.benefit5">üìä ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å</li>
                </ul>
                <button
                    class="signup-btn"
                    onclick="window.location.href='/auth/google'"
                    data-i18n="guest.signup"
                >
                    ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ü‡∏£‡∏µ
                </button>
            </div>
        </div>

        <div class="container">
            <!-- Main Card -->
            <div class="card">
                <!-- QR Code -->
                <div class="qr-container">
                    <img id="qrImage" src="" alt="QR Code" />
                </div>
                <button
                    class="btn-download"
                    id="downloadQRBtn"
                    data-i18n="showlink.downloadQR"
                >
                    üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î QR Code
                </button>

                <!-- Short Link -->
                <div class="link-display">
                    <input type="text" id="shortLinkInput" readonly />
                    <button
                        class="btn-copy"
                        id="copyBtn"
                        data-i18n="showlink.copy"
                    >
                        üìã Copy
                    </button>
                </div>
                <div
                    class="copy-feedback hidden"
                    id="copyFeedback"
                    data-i18n="showlink.copied"
                >
                    ‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!
                </div>

                <!-- Create New Button -->
                <button
                    class="btn-create-new"
                    onclick="window.location.href='/create'"
                    data-i18n="showlink.createNew"
                >
                    ‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á Link ‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>
        </div>

        <script src="/i18n.js"></script>
        <script src="/navbar.js"></script>
        <script>
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get("code");
            let linkData = null;

            if (!code) {
                window.location.href = "/create";
            }

            // Initialize navbar - no callback needed, just hide benefits banner for logged-in users
            const navbar = new Navbar({
                style: "navbar",
                onAuthChange: (user) => {
                    if (user) {
                        document
                            .getElementById("benefitsBanner")
                            .classList.add("hidden");
                    } else {
                        document
                            .getElementById("benefitsBanner")
                            .classList.remove("hidden");
                    }

                    // Update translations after auth change
                    if (window.i18n) {
                        window.i18n.updatePage();
                    }
                },
            });

            // Check auth and load link data
            navbar.checkAuth();

            // Load link data
            async function loadLinkData() {
                try {
                    const response = await fetch(`/api/link/${code}`);
                    if (!response.ok) throw new Error("Link not found");

                    linkData = await response.json();

                    if (linkData.qrCode) {
                        document.getElementById("qrImage").src =
                            linkData.qrCode;
                    }

                    const shortUrl = `${window.location.origin}/${linkData.code}`;
                    document.getElementById("shortLinkInput").value = shortUrl;
                } catch (error) {
                    console.error("Error:", error);
                    alert(window.i18n.t("showlink.errorLoading"));
                    window.location.href = "/create";
                }
            }

            loadLinkData();

            // Copy to clipboard
            document
                .getElementById("copyBtn")
                .addEventListener("click", async () => {
                    const input = document.getElementById("shortLinkInput");
                    try {
                        await navigator.clipboard.writeText(input.value);
                    } catch (error) {
                        input.select();
                        document.execCommand("copy");
                    }

                    const feedback = document.getElementById("copyFeedback");
                    feedback.classList.remove("hidden");
                    setTimeout(() => feedback.classList.add("hidden"), 2000);
                });

            // Download QR Code
            document
                .getElementById("downloadQRBtn")
                .addEventListener("click", () => {
                    if (linkData?.qrCode) {
                        const link = document.createElement("a");
                        link.href = linkData.qrCode;
                        link.download = `DUDX-QR-${linkData.code}.png`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                });
        </script>
    </body>
</html>
